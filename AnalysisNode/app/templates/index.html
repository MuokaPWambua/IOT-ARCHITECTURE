<!DOCTYPE html>
<html>
<head>
    <title>Meteorological Application</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

    <style>
        
    </style>      
</head>
<body>

    <div>
        <h1 align='center'>Weather Conditions</h1>
        
        <div class='container'>
            <div class='row'>
                <div class='col-12'>
                    <h1>Average Conditions</h1>
                    <p>Average humidity: {{humidity_average}}</p>
                    <p> Average temperature: {{temperature_average}}</p>
                </div>
            </div>    
        </div>
        
        <div class='container'>
            <div class="row">    
                <div class='col'>
                    <h1>Humidity</h1>
                    <canvas id="humidityChart" style="width:100%;"></canvas>
                </div>
                <div class='col'>    
                    <h1>Temperature</h1>
                    <canvas id="temperatureChart" style="width:100%;"></canvas>
                </div>    
            </div>
        </div>
        
        <div class="container">
            <canvas id="line"></canvas>
        </div>
    
        <div class='container'>
            <div class='row'>
            <div class='col-12'>
                <table>
                    <tr>
                        <th>Humidity</th>
                        <th>Temperature</th>
                        <th>Sensor Name</th>
                        <th>Date Time</th>
                    </tr>
                    {% for row in data %}
                    <tr>
                        <td>{{ row[1] }}</td>
                        <td>{{ row[2] }}</td>
                        <td>{{ row[3] }}</td>
                        <td>{{ row[4] }}</td>
                    </tr>
                    {% endfor %}
                </table>
            </div>
            </div>
        </div>
    </div>
    

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>

    <script>
        var timeFormat = 'moment.ISO_8601';
        var lineChart = document.getElementById('line').getContext('2d');

        var config = {
        type: 'line',
            data: {
                datasets: [ 
                    {
                        label: "Temperature",
                        backgroundColor: "#fff",
                        borderWidth: 1,
                        pointBorderWidth: 1,
                        borderColor: "#f00",
                        data: [{
                            x: "2010-01-01T05:06:07", y: 175
                        }, {
                            x: "2011-01-01T05:06:07", y: 175
                        }, {
                            x: "2012-01-01T05:06:07", y: 178
                        }, {
                            x: "2013-01-01T05:06:07", y: 200
                        }],
                        fill: false,
                        borderColor: 'red'
                    },
                    {
                        label: "Humidity",
                        borderWidth: 1,
                        pointBorderWidth: 0,
                        backgroundColor: "#fff",
                        data:  [{
                            x: "2010-01-01T05:06:07", y: 160
                        }, {
                            x: "2011-01-01T05:06:07", y: 175
                        }, {
                            x: "2012-01-01T05:06:07", y: 178
                        }, {
                            x: "2013-01-01T05:06:07", y: 178
                        }],
                        fill: false,
                        borderColor: 'blue'
                    }
                ]
            },
            options: {
                legend: {
                    display: true,
                    labels: {
                    usePointStyle: true,
                    },
                    onClick: () => { }, // disable legend onClick functionality that filters datasets
                },
                responsive: true,
                title: {
                    display: true,
                    text:    "Humidity Temperature Data Over Time"
                },
                elements: {
                    point: {
                    radius: 0,
                    hitRadius: 5,
                    hoverRadius: 3,
                    },
                },
                scales:     {
                    xAxes: [{
                        type: "time",
                        time: {
                            format: timeFormat,
                            tooltipFormat: 'll'
                        },
                        displayFormats: {
                            year: 'YYYY'
                        },
                        scaleLabel: {
                            display: true,
                            labelString: 'Date'
                        }
                    }],
                    yAxes: [{
                        scaleLabel: {
                            display:     true,
                            labelString: 'value'
                        }
                    }]
                }
            }
    };

    var myLineChart = new Chart(lineChart, config);
    </script>

    <script>
        var humidityValues = []
        var temperatureValues = []
        {% for row in data %}
            humidityValues.push({x:{{row[4]}}, y:{{row[1]}} })
            temperatureValues.push({x:{{row[4]}}, y:{{row[2]}} }) 
        {% endfor%}

        const humidityChart = new Chart("humidityChart", {
            type: "scatter",
            data: {
                datasets: [{
                    pointRadius: 4,
                    pointBackgroundColor: "rgba(0,0,255,1)",
                    data: humidityValues
                }]
            },
            options: {
                legend: {display: true},
            }
        });
        const temperatureChart = new Chart("temperatureChart", {
            type: "scatter",
            data: {
                datasets: [{
                    pointRadius: 4,
                    pointBackgroundColor: "rgba(0,0,255,1)",
                    data: temperatureValues
                }]
            },
            options: {
                legend: {display: true},
            }
        });
    </script>  
</body>

</html>
